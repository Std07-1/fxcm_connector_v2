{
    "$id": "ohlcv_v1",
    "type": "object",
    "additionalProperties": false,
    "required": ["symbol", "tf", "source", "complete", "synthetic", "bars"],
    "properties": {
        "symbol": { "type": "string", "minLength": 1 },
        "tf": { "type": "string", "enum": ["1m", "5m", "15m", "1h", "4h", "1d"] },
        "source": { "type": "string", "enum": ["stream", "history", "history_agg", "synthetic"] },
        "complete": { "type": "boolean" },
        "synthetic": { "type": "boolean" },
        "ingest_ts": { "type": "integer", "minimum": 0 },
        "bars": {
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                    "open_time",
                    "close_time",
                    "open",
                    "high",
                    "low",
                    "close",
                    "volume",
                    "complete",
                    "synthetic",
                    "source"
                ],
                "properties": {
                    "open_time": { "type": "integer", "minimum": 0 },
                    "close_time": { "type": "integer", "minimum": 0 },
                    "open": { "type": "number" },
                    "high": { "type": "number" },
                    "event_ts": { "type": "integer", "minimum": 0 },
                    "low": { "type": "number" },
                    "close": { "type": "number" },
                    "volume": { "type": "number" },
                    "complete": { "type": "boolean" },
                    "synthetic": { "type": "boolean" },
                    "source": { "type": "string", "enum": ["stream", "history", "history_agg", "synthetic"] },
                    "tick_count": { "type": "integer", "minimum": 0 }
                },
                "allOf": [
                    {
                        "if": {
                            "properties": { "complete": { "const": true } },
                            "required": ["complete"]
                        },
                        "then": {
                            "properties": {
                                "synthetic": { "const": false },
                                "source": { "enum": ["history", "history_agg"] },
                                "event_ts": { "type": "integer", "minimum": 0 }
                            },
                            "required": ["synthetic", "source", "event_ts"]
                        }
                    }
                ]
            }
        }
    },
    "allOf": [
        {
            "if": {
                "properties": { "complete": { "const": true } },
                "required": ["complete"]
            },
            "then": {
                "properties": {
                    "synthetic": { "const": false },
                    "source": { "enum": ["history", "history_agg"] }
                },
                "required": ["synthetic", "source"]
            }
        }
    ]
}